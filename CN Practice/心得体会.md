
## 互联IP地址为何使用30位掩码网段？
在互联网中，使用30位掩码的网段可以提供更多的IP地址。

一个30位掩码的IP地址可以支持4个主机地址，因为有两个主机地址必须保留（一个用于网络地址，另一个用于广播地址）。

这种IP地址结构通常用于连接两个网络设备之间的点对点连接，如路由器之间的连接。

使用30位掩码的网段可以使网络管理员更有效地使用IP地址，同时提高网络的安全性和性能。


## 接入层技术分析
1. VLAN 与 VLANIF的关系
2. VLANIF与物理端口的关系
3. 为何接入层部署二层技术，而不直接三层终结？

### access端口：

通过access端口的数据包都是不带VLAN tag的，且只属于一个VLAN；

在access端口进方向，交换机接收到数据包后，先判断是否带VLAN tag，有则丢弃数据包，没有则打上该端口已配置的VLAN tag；

在access端口出方向，交换机将打了与端口相同VLAN tag的数据包转发出去，并且去掉VLAN tag变成普通数据包。

### trunk端口：

通过trunk端口的数据包都必须带上VLAN tag；

在trunk端口进方向，交换机接收到数据包后，先判断是否带VLAN tag，没有则丢弃数据包，有则按照对应VLAN进行转发；

在trunk端口出方向，交换机将带VLAN tag的数据包原封不动转发出去，没有带VLAN tag数据包不会从trunk端口转发出去。

### VLANIF 
在配置好二层vlan后，三层交换机上使用vlanif命令建立对应vlan的路由，配置完成后，可以实现VLAN之间的通信。

VLANIF是指基于虚拟局域网技术(VLAN)创建的虚拟接口

而VLANIF是基于VLAN技术创建的虚拟接口。通过VLANIF接口，可以将不同VLAN中的设备进行通信，实现跨VLAN的互通。VLANIF接口通常是在路由器上配置，用于实现VLAN的路由。

具体来说，当一个数据包从一个VLAN中的设备进入VLANIF接口时，路由器会根据路由表信息，将数据包转发到另一个VLAN中的设备。当数据包从VLANIF接口转发到物理端口时，交换机会根据VLAN ID将数据包转发到相应的VLAN中，再根据目的MAC地址将数据包转发给相应的设备。

### 二层技术，而不直接三层终结？
在网络架构中，通常使用层次化设计来组织网络，将不同的功能和服务划分到不同的层次中。常见的网络层次结构包括物理层、数据链路层、网络层、传输层、会话层、表示层和应用层。

当我们考虑在网络中部署二层技术还是三层技术时，主要是因为这些技术各自有不同的优缺点，需要根据具体的应用场景来选择。

二层技术主要指的是使用MAC地址进行通信和转发的技术，如交换机。二层技术的优点包括转发速度快、网络拓扑简单、不需要配置IP地址等。因此，在需要高速转发、对网络拓扑要求不高、或者需要简单部署的场景下，使用二层技术是比较合适的选择。例如，在局域网中，可以使用交换机进行二层通信，因为在同一局域网中的设备的MAC地址是唯一的。

但是，二层技术也有缺点。由于二层通信只使用MAC地址进行转发，因此不支持跨子网通信。此外，二层技术的广播和组播功能容易引起网络拥塞，而且很难进行流量控制和故障隔离。

相比之下，三层技术主要指的是使用IP地址进行通信和转发的技术，如路由器。三层技术的优点包括支持跨子网通信、可以进行流量控制和故障隔离、支持广播和组播控制等。因此，在需要进行跨子网通信、需要进行路由控制、需要进行故障隔离等场景下，使用三层技术是比较合适的选择。例如，在Internet中，使用路由器进行IP数据包的转发和路由选择。

总的来说，当我们需要在网络中部署二层技术还是三层技术时，需要根据具体的应用场景来选择。在一些小型的、不需要进行跨子网通信和路由控制的网络中，使用二层技术可能更加合适；而在一些大型的、需要进行跨子网通信和路由控制的网络中，使用三层技术可能更加合适。同时，也可以结合二层和三层技术的优点，采用混合的网络架构，来更好地满足不同的需求。


## 汇聚层和核心层

### 路由冗余保护原理

RRP协议的原理是：在网络中存在多个路由器时，每个路由器都会通过RRP协议发送RRP报文，向其它路由器宣告自己的存在。路由器之间通过RRP报文交互，从而发现所有的邻居路由器，并维护一个RRP邻居表。如果某个路由器失效，其它路由器可以通过RRP邻居表快速地发现该路由器失效，并重新计算路由表，从而保证网络的连通性。


### 数据面如何实现多个冗余路径的？

在数据通信中实现多个冗余路径通常需要使用一种叫做“多路径传输”（Multipath Transport）的技术。多路径传输是指在数据通信中同时利用多条不同的通信路径，以提高数据传输的可靠性和效率

在多路径传输中，数据被分成多个数据包，并且这些数据包可以通过不同的路径进行传输。在接收端，这些数据包被重新组合成原始的数据。如果其中一条路径出现了问题，数据包可以通过其他路径重新传输，以保证数据的完整性和可靠性


### 环路
路由器间出现环路时，报文将在环路中不断循环转发，这可能导致网络出现拥塞、延迟和丢包等问题。

当路由器收到一个报文时，它会查找转发表以确定报文的下一个路由器。如果转发表中指定的下一个路由器是一个在环路上的路由器，那么该报文将被发送到该路由器，该路由器也会将报文继续转发到下一个路由器，从而形成一个循环。


为了避免环路报文的转发问题，可以采用以下方法之一：

1.使用动态路由协议：动态路由协议可以动态地计算最短路径，从而避免环路的产生。当网络中某个路由器发生故障或链路状态改变时，动态路由协议可以及时地重新计算最短路径，从而保证网络的正常运行。

2.使用Spanning Tree Protocol(STP)： STP是一种链路层协议，它可以自动建立一个无环树形拓扑结构，从而避免环路的产生。当网络中发生故障时，STP可以及时地重新计算最短路径，从而保证网络的正常运行。

3.手动配置路由器转发表：管理员可以手动配置路由器转发表，从而避免将报文发送到在环路上的路由器。这需要管理员具有一定的网络知识和技能，同时也需要对网络进行持续的监控和维护，以确保网络的正常运行。


在本次的实践设计中，汇聚层和核心层交换机形成了环路。
```
undo stp enable
```



### 缺省路由的作用及其转发原理
缺省路由（Default Route）是指当路由表中没有匹配的目标网络时，路由器所采用的默认路由。它的作用是将数据包发送到一个预定的网关，以使其能够到达目的网络。

当路由器接收到一个数据包时，它会首先检查该数据包的目的IP地址，然后查询路由表以确定下一跳的地址。如果路由表中没有与目的IP地址匹配的网络，则路由器将查找缺省路由。缺省路由是一个预先定义的路由，它告诉路由器将数据包发送到预设的网关。这个网关可以是另一个路由器，也可以是一个特殊的设备，如网关路由器或防火墙。

在转发数据包时，路由器会根据最长匹配原则进行路由选择。它会查找路由表中与目的IP地址最长匹配的网络，并将数据包发送到相应的下一跳。如果没有匹配的网络，路由器就会将数据包转发到缺省路由指定的网关。

缺省路由通常用于连接不同的自治系统或互联网。在这些情况下，路由器可能会收到大量的外部数据包，这些数据包的目的IP地址不在本地网络中。如果路由器没有缺省路由，则这些数据包将被丢弃，从而导致通信中断。通过设置缺省路由，路由器可以将这些数据包转发到指定的网关，以便它们可以到达目的网络。

### 两个私网终端 P2P 流量如何穿透NAT？
建立VPN隧道是一种实现NAT穿透的有效方法。通过VPN隧道，可以将两个私有网络之间建立一个安全的、加密的通道，以便在不同的NAT网络中实现直接通信。

### BGP 与OSPF 应用场景的差别
BGP是一种自治系统（AS）之间的路由协议，主要用于在不同AS之间交换路由信息，例如在互联网中不同ISP之间交换路由信息。BGP可以实现非常复杂的路由策略，例如路径选择、路由筛选和路由汇聚。因此，BGP适用于需要管理和控制多个自治系统之间路由的场景，例如互联网服务提供商（ISP）之间的路由管理、多个数据中心之间的路由管理等。 

相比之下，OSPF是一种在同一个自治系统内部的路由协议，它主要用于在一个自治系统内部交换路由信息。OSPF使用开放式最短路径优先算法，可以实现快速且可靠的路由计算。因此，OSPF适用于需要在同一个自治系统内部进行路由管理的场景，例如企业内部的网络管理、数据中心内部的网络管理等。



## 关于ARP攻击 

ARP协议是将IP地址转换成物理地址（MAC地址）的一种协议，通常在局域网内使用。ARP攻击者利用ARP协议的“请求响应”机制，发送虚假的ARP响应包或ARP请求包，以欺骗目标主机或路由器，让其将网络流量发送到攻击者所指定的MAC地址。常见的ARP攻击方式包括以下几种：

1.  ARP欺骗攻击（ARP Spoofing）：攻击者发送虚假的ARP响应包，欺骗目标主机或路由器将网络流量发送到攻击者所指定的MAC地址。
    
2.  中间人攻击（Man-in-the-Middle，MitM）：攻击者通过ARP欺骗攻击，将自己伪装成网络中的一个合法设备，从而可以获取目标主机或路由器的网络流量，并对其进行篡改或监听。
    
3.  ARP病毒攻击（ARP Virus）：攻击者通过广播大量的虚假ARP请求包，使网络中的所有主机和路由器都认为攻击者的MAC地址对应于某个IP地址，从而导致网络拥塞或崩溃。

为了防止ARP攻击，可以采取以下几种措施：

1.  静态ARP绑定（Static ARP Binding）：管理员可以手动配置ARP表项，将IP地址与MAC地址绑定在一起，从而避免虚假ARP响应包的欺骗。
    
2.  使用网络安全设备：如防火墙、入侵检测系统等，可以检测和阻止ARP攻击。
    
3.  安全网络架构设计：合理的网络架构设计可以有效地防止ARP攻击，如采用VLAN分隔、物理隔离等方式，限制网络攻击的范围和影响。

在实验攻防的过程中，不妨在别的组上配置一条错误的静态arp表项
```
在别人的汇聚层交换机上，开始 arp 攻击 
所有访问静态PC，都失灵，packet 因为汇聚层交换机的叛变

在静态PC上
# 查看IP地址
ipconfig   //查看IP地址

在汇聚层交换机上
# 查看arp 映射表
disp display arp all 
清除静态ARP表项
reset arp all
配置一条假的 arp 表项
arp static 10.1.2.2 5489-9868-0ec2 vid 20 interface gigabitethernet 0/0/1
# vid 表示 vlan

# arp static 
# 在接入层交换机上 
[] arp static <ip地址> <改成自己端口的mac,欺骗一下> vlan20 gigabitethernet 0/0/1 

就把中间的Mac地址改变一下
arp static 10.1.2.2 5489-9868-0ec2 vid 10 interface gigabitethernet 0/0/1
```

